<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Totem M√∫sica</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; background:#111; color:#fff; text-align:center; padding:20px; }
h1 { margin-bottom:20px; }
button {
margin:6px;
padding:10px 14px;
font-size:14px;
border:none;
border-radius:8px;
cursor:pointer;
}
.exec { background:#e10600; color:#fff; }
.unlock { background:#00bfff; color:#000; }
.reset { background:orange; color:#000; margin-top:20px; }
.rankItem { margin:8px 0; font-size:18px; }
</style>
</head>
<body>

<h1>üîê Painel Administrativo</h1>
<div id="rankingList"></div>
<button class="reset" onclick="resetar()">RESETAR SISTEMA</button>

<script>

const urlParams = new URLSearchParams(window.location.search);
if(urlParams.get("senha") !== "12345"){
document.body.innerHTML="<h2>Acesso negado</h2>";
throw new Error("Sem acesso");
}

const firebaseConfig = {
apiKey: "AIzaSyCxpYTjgDElVqhhG-OUXJGIWXapifaZ9Zw",
authDomain: "totem-12c8a.firebaseapp.com",
databaseURL: "https://totem-12c8a-default-rtdb.firebaseio.com",
projectId: "totem-12c8a"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

function resetar(){
if(confirm("Tem certeza que deseja resetar tudo?")){
database.ref("ranking").set({});
database.ref("executadas").set({});
alert("Sistema resetado!");
}
}

database.ref("ranking").on("value",snap=>{
const data=snap.val()||{};
const sorted=Object.entries(data).sort((a,b)=>b[1]-a[1]);

let container = document.getElementById("rankingList");
container.innerHTML="";

sorted.forEach(item=>{
let div = document.createElement("div");
div.className = "rankItem";

let titulo = document.createElement("div");
titulo.innerText = item[0] + " - " + item[1] + " votos";

let btnExec = document.createElement("button");
btnExec.className="exec";
btnExec.innerText="Marcar como Executada";
btnExec.onclick=function(){ executar(item[0]); };

let btnUnlock = document.createElement("button");
btnUnlock.className="unlock";
btnUnlock.innerText="Desbloquear";
btnUnlock.onclick=function(){ desbloquear(item[0]); };

div.appendChild(titulo);
div.appendChild(btnExec);
div.appendChild(btnUnlock);

container.appendChild(div);
});

});

function executar(musica){
database.ref("executadas/"+musica).set(true);
alert("M√∫sica marcada como executada!");
}

function desbloquear(musica){
database.ref("executadas/"+musica).set(false);
alert("M√∫sica desbloqueada!");
}

</script>
</body>
</html>
