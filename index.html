<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Totem de Vota√ß√£o - Money Talks</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; background:#000; color:#fff; text-align:center; padding:20px; }
h1 { margin-bottom:20px; }
input { width:80%; max-width:400px; padding:12px; font-size:18px; margin-bottom:20px; border-radius:10px; border:none; }
button { display:block; width:80%; max-width:350px; margin:8px auto; padding:16px; font-size:18px; border:none; border-radius:12px; cursor:pointer; background:#e10600; color:white; }
button:disabled { background:gray; cursor:not-allowed; }
.rankItem { font-size:20px; margin:6px 0; }
.category { font-size:22px; margin-top:25px; color:#00bfff; text-decoration:underline; }
.artist { font-weight:bold; margin-top:10px; }
.executada { background:#444 !important; }
</style>
</head>
<body>

<div id="conteudo"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxpYTjgDElVqhhG-OUXJGIWXapifaZ9Zw",
  authDomain: "totem-12c8a.firebaseapp.com",
  databaseURL: "https://totem-12c8a-default-rtdb.firebaseio.com",
  projectId: "totem-12c8a"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const conteudo = document.getElementById("conteudo");

let musicasExecutadas = {};
let bloqueadoMusicas = {}; // temporizador por m√∫sica

// **Atualiza√ß√£o em tempo real**
database.ref("executadas").on("value", snap => {
  musicasExecutadas = snap.val() || {};
  criarBotoes(document.getElementById("searchInput")?.value?.toLowerCase() || "");
});

database.ref("sistemaStatus").on("value", snap => {
  const status = snap.val();
  if(status !== "on"){
    conteudo.innerHTML = `
      <h1>üéµ Sistema dispon√≠vel apenas nos shows, volte sempre!</h1>
      <div id="bloqueado">üîí Vota√ß√£o temporariamente indispon√≠vel.</div>
    `;
    return;
  }

  conteudo.innerHTML = `
    <h1>Escolha a pr√≥xima m√∫sica</h1>
    <input type="text" id="searchInput" placeholder="üîç Buscar m√∫sica ou artista">
    <div id="buttons"></div>
    <h2>Ranking ao Vivo</h2>
    <div id="rankingList"></div>
  `;

  iniciarSistema();
});

function iniciarSistema(){
  const container = document.getElementById("buttons");

  const musicas = {
    "Rock Nacional": {
      "Os Paralamas do Sucesso":["Meu Erro"],
      "Skank":["Garota Nacional","Sutilmente"],
      "Bar√£o Vermelho":["Bete Balan√ßo"],
      "Legi√£o Urbana":["Pais E Filhos","Tempo Perdido"],
      "Cazuza":["Exagerado"],
      "Frejat":["Segredos"],
      "Tit√£s":["Pra Dizer Adeus"],
      "Lob√£o":["Me Chama","R√°dio Bl√°"]
    },
    "Cl√°ssicos Internacionais": {
      "Elvis Presley":["Suspicious Minds"],
      "The Beatles":["Come Together","Hey Jude","Let It Be"],
      "Ben E. King":["Stand By Me"],
      "Pink Floyd":["Wish You Were Here"],
      "Lynyrd Skynyrd":["Sweet Home Alabama","Simple Man"],
      "Commodores":["Easy"],
      "Eric Clapton":["Cocaine"],
      "Queen":["Another One Bites The Dust"],
      "The Doors":["Roadhouse Blues","Love Me Two Times","Riders On The Storm"],
      "Cream":["White Room","Sunshine Of Your Love"],
      "Black Sabbath":["Paranoid"],
      "Survivor":["Eye Of The Tiger"],
      "Foghat":["Slow Ride"]
    },
    "Grunge / Alternativo": {
      "Nirvana":["Smells Like Teen Spirit","Come As You Are","Heart-Shaped Box","About A Girl","Drain You"],
      "Pearl Jam":["Soldier of Love","Last Kiss","Black"],
      "Alice In Chains":["Man In The Box","Would?","Down In A Hole"],
      "Stone Temple Pilots":["Plush","Interstate Love Song","Creep","Vasoline"],
      "The Smashing Pumpkins":["1979","Bullet With Butterfly Wings","Zero"],
      "Queens of the Stone Age":["No One Knows","Make It Wit Chu"],
      "Radiohead":["Creep"],
      "Faith No More":["Ashes to Ashes"],
      "Silverchair":["Freak"]
    },
    "Anos 80 / 90 / 2000": {
      "U2":["With Or Without You","Helter Skelter"],
      "INXS":["Never Tear Us Apart","Need You Tonight"],
      "Phil Collins":["I Don't Care Anymore"],
      "Tears For Fears":["Everybody Wants To Rule The World"],
      "Blur":["Coffee & TV"],
      "Modjo":["Lady"],
      "Jimmy Cliff":["I Can See Clearly Now"],
      "Mike + The Mechanics":["Over My Shoulder"],
      "Sugar Ray":["Every Morning"],
      "Spin Doctors":["Two Princes"],
      "Foreigner":["I Want To Know What Love Is"],
      "The Outfield":["Your Love"],
      "Lenny Kravitz":["It Ain't Over 'Til It's Over","Fly Away"],
      "Maroon 5":["Sugar"],
      "Oasis":["Wonderwall"],
      "Kings of Leon":["Closer"],
      "Green Day":["American Idiot"],
      "Foo Fighters":["Everlong","Learn to Fly"],
      "The White Stripes":["Seven Nation Army"],
      "Daft Punk":["Get Lucky"],
      "Chris Isaak":["Wicked Game"],
      "Urge Overkill":["Girl, You'll Be a Woman Soon"]
    },
    "Soul / Brasil": {
      "Tim Maia":["Gostava Tanto de Voc√™","Primavera (Vai Chuva)"]
    }
  };

  function criarBotoes(filter=""){
    container.innerHTML="";
    let encontrou=false;

    Object.keys(musicas).forEach(cat=>{
      let categoriaTemResultado=false;
      let catDiv=document.createElement("div");

      Object.keys(musicas[cat]).forEach(artista=>{
        let artistaTemResultado=false;
        let artistaDiv=document.createElement("div");

        musicas[cat][artista].forEach(musica=>{
          if(filter && !musica.toLowerCase().includes(filter) && !artista.toLowerCase().includes(filter)) return;

          encontrou=true;
          categoriaTemResultado=true;
          artistaTemResultado=true;

          const btn=document.createElement("button");
          btn.setAttribute("data-nome", musica);

          if(musicasExecutadas[musica]){
            btn.innerText="üîí "+musica+" (J√° executada)";
            btn.disabled = true;
            btn.classList.add("executada");
          } else if(bloqueadoMusicas[musica]){
            btn.disabled = true;
            btn.innerText = musica+" ‚è≥ Aguarde "+bloqueadoMusicas[musica]+"s";
          } else {
            btn.innerText = musica;
            btn.onclick = () => voteMusica(musica);
          }

          artistaDiv.appendChild(btn);
        });

        if(artistaTemResultado){
          let artTitle=document.createElement("div");
          artTitle.className="artist";
          artTitle.innerText=artista;
          catDiv.appendChild(artTitle);
          catDiv.appendChild(artistaDiv);
        }
      });

      if(categoriaTemResultado){
        let catTitle=document.createElement("div");
        catTitle.className="category";
        catTitle.innerText=cat;
        container.appendChild(catTitle);
        container.appendChild(catDiv);
      }
    });

    if(!encontrou){
      container.innerHTML="<h2>‚ùå M√∫sica n√£o encontrada</h2>";
    }
  }

  function voteMusica(musica){
    if(bloqueadoMusicas[musica] || musicasExecutadas[musica]) return;

    // Incrementa ranking
    database.ref("ranking/"+musica).transaction(v => (v||0)+1);

    // Ativa temporizador s√≥ para essa m√∫sica
    let tempo = 30;
    bloqueadoMusicas[musica] = tempo;
    criarBotoes(document.getElementById("searchInput").value.toLowerCase());

    const intervalo = setInterval(()=>{
      tempo--;
      bloqueadoMusicas[musica] = tempo;
      criarBotoes(document.getElementById("searchInput").value.toLowerCase());

      if(tempo<=0){
        clearInterval(intervalo);
        delete bloqueadoMusicas[musica];
        criarBotoes(document.getElementById("searchInput").value.toLowerCase());
      }
    },1000);
  }

  document.getElementById("searchInput").addEventListener("input", e=>{
    criarBotoes(e.target.value.toLowerCase());
  });

  database.ref("ranking").on("value", snap=>{
    const data = snap.val() || {};
    const sorted = Object.entries(data).sort((a,b)=>b[1]-a[1]);
    let html="";
    sorted.forEach((item,i)=>{
      html+="<div class='rankItem'>"+(i+1)+"¬∫ - "+item[0]+" ("+item[1]+" votos)</div>";
    });
    document.getElementById("rankingList").innerHTML = html;
  });

  criarBotoes();
}
</script>
</body>
</html>
