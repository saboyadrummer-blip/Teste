<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Totem de Vota√ß√£o - Money Talks</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; background:#000; color:#fff; text-align:center; padding:20px; }
h1 { margin-bottom:20px; }
input { width:80%; max-width:400px; padding:12px; font-size:18px; margin-bottom:20px; border-radius:10px; border:none; }
button { display:block; width:80%; max-width:350px; margin:8px auto; padding:16px; font-size:18px; border:none; border-radius:12px; cursor:pointer; background:#e10600; color:white; }
button:disabled { background:gray; cursor:not-allowed; }
.rankItem { font-size:20px; margin:6px 0; }
.category { font-size:22px; margin-top:25px; color:#00bfff; text-decoration:underline; }
.artist { font-weight:bold; margin-top:10px; }
.executada { background:#444 !important; }
.hidden { display:none; }
</style>
</head>
<body>

<div id="bloqueado" class="hidden">
<h1>üéµ Sistema dispon√≠vel apenas nos shows, volte sempre!</h1>
<div>üîí Vota√ß√£o temporariamente indispon√≠vel.</div>
</div>

<div id="sistema">
<h1>Escolha a pr√≥xima m√∫sica</h1>
<input type="text" id="searchInput" placeholder="üîç Buscar m√∫sica ou artista">
<div id="buttons"></div>
<h2>Ranking ao Vivo</h2>
<div id="rankingList"></div>
</div>

<script>
const firebaseConfig = {
apiKey: "AIzaSyCxpYTjgDElVqhhG-OUXJGIWXapifaZ9Zw",
authDomain: "totem-12c8a.firebaseapp.com",
databaseURL: "https://totem-12c8a-default-rtdb.firebaseio.com",
projectId: "totem-12c8a"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

const sistemaDiv = document.getElementById("sistema");
const bloqueadoDiv = document.getElementById("bloqueado");
const container = document.getElementById("buttons");
const rankingDiv = document.getElementById("rankingList");
const searchInput = document.getElementById("searchInput");

let musicasExecutadas = {};
let temporizadores = {};

const musicas = {

"Rock Nacional": {
"Os Paralamas do Sucesso":["Meu Erro"],
"Skank":["Garota Nacional","Sutilmente"],
"Bar√£o Vermelho":["Bete Balan√ßo"],
"Legi√£o Urbana":["Pais e Filhos","Tempo Perdido"],
"Cazuza":["Exagerado"],
"Frejat":["Segredos"],
"Tit√£s":["Pra Dizer Adeus","Son√≠fera Ilha","√â Preciso Saber Viver","Epit√°fio"],
"Lob√£o":["Me Chama","R√°dio Bl√°"],
"Ira!":["Tarde Vazia","Envelhe√ßo na Cidade"],
"Capital Inicial":["Primeiros Erros","√Ä Sua Maneira"],
"Los Hermanos":["Anna J√∫lia"]
},

"Cl√°ssicos Internacionais": {
"Elvis Presley":["Suspicious Minds"],
"The Beatles":["Come Together","Hey Jude","Let It Be"],
"Ben E. King":["Stand By Me"],
"Pink Floyd":["Wish You Were Here"],
"Lynyrd Skynyrd":["Sweet Home Alabama","Simple Man"],
"Commodores":["Easy"],
"Eric Clapton":["Cocaine"],
"Queen":["Another One Bites The Dust"],
"The Doors":["Roadhouse Blues","Love Me Two Times","Riders On The Storm"],
"Cream":["White Room","Sunshine Of Your Love"],
"Black Sabbath":["Paranoid"],
"Survivor":["Eye Of The Tiger"],
"Foghat":["Slow Ride"],
"CHIC":["Le Freak","Good Times"],
"KC & The Sunshine Band":["Keep It Comin Love","Shake Your Booty"],
"Bill Withers":["Lovely Day"]
},

"Grunge / Alternativo": {
"Nirvana":["Smells Like Teen Spirit","Come As You Are","Heart Shaped Box","About A Girl","Drain You"],
"Pearl Jam":["Soldier Of Love","Last Kiss","Black"],
"Alice In Chains":["Man In The Box","Would","Down In A Hole"],
"Stone Temple Pilots":["Plush","Interstate Love Song","Creep","Vasoline"],
"The Smashing Pumpkins":["1979","Bullet With Butterfly Wings","Zero"],
"Queens Of The Stone Age":["No One Knows","Make It Wit Chu"],
"Radiohead":["Creep"],
"Faith No More":["Ashes To Ashes"],
"Silverchair":["Freak"],
"The Wallflowers":["One Headlight"],
"Audioslave":["Like A Stone"],
"Wilderado":["Surefire"]
},

"Anos 80 / 90 / 2000": {
"U2":["With Or Without You","Helter Skelter","I Still Havent Found What Im Looking For"],
"INXS":["Never Tear Us Apart","Need You Tonight"],
"Phil Collins":["I Dont Care Anymore"],
"Tears For Fears":["Everybody Wants To Rule The World"],
"Blur":["Coffee And TV"],
"Modjo":["Lady"],
"Jimmy Cliff":["I Can See Clearly Now"],
"Mike And The Mechanics":["Over My Shoulder"],
"Sugar Ray":["Every Morning"],
"Spin Doctors":["Two Princes"],
"Foreigner":["I Want To Know What Love Is"],
"The Outfield":["Your Love"],
"Lenny Kravitz":["It Aint Over Til Its Over","Fly Away"],
"Maroon 5":["Sugar"],
"Oasis":["Wonderwall","Dont Look Back In Anger"],
"Kings Of Leon":["Closer"],
"Green Day":["American Idiot","Basket Case"],
"Foo Fighters":["Everlong","Learn To Fly"],
"The White Stripes":["Seven Nation Army"],
"Daft Punk":["Get Lucky"],
"Chris Isaak":["Wicked Game"],
"Urge Overkill":["Girl Youll Be A Woman Soon"],
"Big Mountain":["Baby I Love Your Way"]
},

"Soul / Brasil": {
"Tim Maia":["Gostava Tanto De Voc√™","Primavera"]
}

};

/* RESTANTE DO SISTEMA INALTERADO */

function criarBotoes(filter=""){
container.innerHTML="";
let encontrou=false;
filter=filter.toLowerCase();

Object.keys(musicas).forEach(cat=>{
let categoriaTem=false;
let catDiv=document.createElement("div");

Object.keys(musicas[cat]).forEach(artista=>{
let artistaTem=false;
let artistaDiv=document.createElement("div");

musicas[cat][artista].forEach(musica=>{
if(filter && !musica.toLowerCase().includes(filter) && !artista.toLowerCase().includes(filter)) return;

encontrou=true;
categoriaTem=true;
artistaTem=true;

const btn=document.createElement("button");

if(musicasExecutadas[musica]){
btn.innerText="üîí "+musica+" (J√° executada)";
btn.disabled=true;
btn.classList.add("executada");
}else if(temporizadores[musica]){
btn.disabled=true;
btn.innerText=musica+" ‚è≥ Aguarde "+temporizadores[musica]+"s";
}else{
btn.innerText=musica;
btn.onclick=()=>voteMusica(musica);
}

artistaDiv.appendChild(btn);
});

if(artistaTem){
let artTitle=document.createElement("div");
artTitle.className="artist";
artTitle.innerText=artista;
catDiv.appendChild(artTitle);
catDiv.appendChild(artistaDiv);
}
});

if(categoriaTem){
let catTitle=document.createElement("div");
catTitle.className="category";
catTitle.innerText=cat;
container.appendChild(catTitle);
container.appendChild(catDiv);
}
});

if(!encontrou){
container.innerHTML="<h2>‚ùå M√∫sica n√£o encontrada</h2>";
}
}

function voteMusica(musica){
database.ref("ranking/"+musica).transaction(v => (v||0)+1);

if(temporizadores[musica]) return;
temporizadores[musica]=30;

const intervalo=setInterval(()=>{
temporizadores[musica]--;
criarBotoes(searchInput.value);

if(temporizadores[musica]<=0){
clearInterval(intervalo);
delete temporizadores[musica];
criarBotoes(searchInput.value);
}
},1000);

criarBotoes(searchInput.value);
}

searchInput.addEventListener("input",e=>{
criarBotoes(e.target.value);
});

database.ref("executadas").on("value",snap=>{
musicasExecutadas=snap.val()||{};
criarBotoes(searchInput.value);
});

database.ref("ranking").on("value",snap=>{
const data=snap.val()||{};
const sorted=Object.entries(data).sort((a,b)=>b[1]-a[1]);
rankingDiv.innerHTML="";
sorted.forEach((item,i)=>{
rankingDiv.innerHTML+="<div class='rankItem'>"+(i+1)+"¬∫ - "+item[0]+" ("+item[1]+" votos)</div>";
});
});

database.ref("sistemaStatus").on("value",snap=>{
const status=snap.val();
if(status==="on"){
sistemaDiv.classList.remove("hidden");
bloqueadoDiv.classList.add("hidden");
}else{
sistemaDiv.classList.add("hidden");
bloqueadoDiv.classList.remove("hidden");
}
});

criarBotoes();
</script>
</body>
</html>
