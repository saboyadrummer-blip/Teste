<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Totem de Vota√ß√£o - M√∫sica</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  text-align: center;
  padding: 20px;
}
h1 { margin-bottom: 20px; }
input[type="text"] {
  width: 80%;
  max-width: 400px;
  padding: 12px;
  font-size: 18px;
  margin-bottom: 20px;
  border-radius: 10px;
  border: none;
}
button {
  display: block;
  width: 80%;
  max-width: 350px;
  margin: 8px auto;
  padding: 16px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: #e10600;
  color: white;
  transition: 0.2s;
}
button:hover { background: #ff3b30; }
button:disabled { background: gray; cursor: not-allowed; }

h2 { margin-top: 40px; }
.rankItem { font-size: 22px; margin: 6px 0; }
#message { font-size: 22px; margin-top: 20px; color: #00ff88; }
#countdown { font-size: 28px; color: #ffdd00; margin-top: 20px; }
.category { font-size: 22px; margin-top: 25px; color: #00bfff; text-decoration: underline; }
</style>
</head>

<body>

<h1>Escolha a pr√≥xima m√∫sica</h1>
<input type="text" id="searchInput" placeholder="üîç Buscar m√∫sica ou artista">

<div id="buttons"></div>
<div id="message"></div>
<div id="countdown"></div>

<h2>Ranking ao Vivo</h2>
<div id="rankingList"></div>

<script>
// CONFIGURA√á√ÉO DO FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCxpYTjgDElVqhhG-OUXJGIWXapifaZ9Zw",
  authDomain: "totem-12c8a.firebaseapp.com",
  databaseURL: "https://totem-12c8a-default-rtdb.firebaseio.com",
  projectId: "totem-12c8a",
  storageBucket: "totem-12c8a.appspot.com",
  messagingSenderId: "308642629645",
  appId: "1:308642629645:web:dfa6a4ce6dd85de4bced44"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// CATEGORIAS DE M√öSICA
const musicas = {
  "Rock Nacional": {
    "Paralamas do Sucesso": ["Meu Erro"],
    "Skank": ["Garota Nacional", "Sutilmente"],
    "Tit√£s": ["Pra Dizer Adeus"],
    "Lob√£o": ["Me Chama","Bl√°, Bl√°, Bl√°... Eu Te Amo","R√°dio Bl√°"],
    "Bar√£o Vermelho": ["Bete Balan√ßo"],
    "Legi√£o Urbana": ["Pais E Filhos"]
  },
  "MPB/Soul": {
    "Tim Maia": ["Gostava Tanto de Voc√™","Primavera (Vai Chuva)"],
    "Djavan": ["Lil√°s"],
    "Ben E. King": ["Stand By Me"]
  },
  "Rock Internacional": {
    "Nirvana": ["Smells Like Teen Spirit","Come As You Are","Heart-Shaped Box","About A Girl","Drain You"],
    "Pearl Jam": ["Soldier of Love","Last Kiss","Black"],
    "U2": ["With Or Without You","Helter Skelter"],
    "Pink Floyd": ["Wish You Were Here"],
    "Lynyrd Skynyrd": ["Sweet Home Alabama","Simple Man"],
    "Foo Fighters": ["Everlong"],
    "Radiohead": ["Creep"],
    "Tears For Fears": ["Everybody Wants To Rule The World"],
    "Daft Punk": ["Get Lucky"],
    "Creedence Clearwater Revival": ["Proud Mary","Have You Ever Seen The Rain","Suzie Q","Born On The Bayou","Bad Moon Rising","Fortunate Son"],
    "The Police": ["Roxanne","Every Breath You Take"],
    "The Rolling Stones": ["Anybody Seen My Baby?"],
    "Cream": ["White Room","Sunshine Of Your Love"],
    "INXS": ["Never Tear Us Apart","Need You Tonight"],
    "Led Zeppelin": ["Immigrant Song","Rock And Roll"],
    "Queens of the Stone Age": ["No One Knows","Make It Wit Chu"],
    "The Doors": ["Roadhouse Blues","Love Me Two Times","Riders On The Storm"],
    "The White Stripes": ["Seven Nation Army"],
    "Alice In Chains": ["Man In The Box","Would?","Down In A Hole"],
    "Black Sabbath": ["Paranoid"],
    "Stone Temple Pilots": ["Plush","Interstate Love Song","Creep"],
    "Frejat": ["Segredos"],
    "Billy Idol": ["White Wedding"],
    "Tom Petty": ["Runnin' Down A Dream"],
    "Foghat": ["Slow Ride"],
    "Phil Collins": ["I Don't Care Anymore"],
    "Cazuza": ["Exagerado"],
    "Foreigner": ["I Want To Know What Love Is"],
    "The Outfield": ["Your Love"],
    "Modjo": ["Lady"],
    "Blur": ["Coffee & TV"],
    "Jimmy Cliff": ["I Can See Clearly Now"],
    "Mike + The Mechanics": ["Over My Shoulder"],
    "Sugar Ray": ["Every Morning"],
    "Spin Doctors": ["Two Princes"],
    "Lenny Kravitz": ["It Ain't Over 'Til It's Over","Fly Away"],
    "Oasis": ["Wonderwall"],
    "Maroon 5": ["Sugar"],
    "Kings of Leon": ["Closer"],
    "Green Day": ["American Idiot"],
    "The Smashing Pumpkins": ["1979"]
  },
  "Cl√°ssicos e Rock Antigo": {
    "Elvis Presley": ["Suspicious Minds"],
    "The Beatles": ["Come Together","Hey Jude","Let It Be"],
    "Queen": ["Another One Bites The Dust"],
    "Eric Clapton": ["Cocaine"],
    "Chris Isaak": ["Wicked Game"]
  }
};

const container = document.getElementById("buttons");
const message = document.getElementById("message");
const countdownDiv = document.getElementById("countdown");
let bloqueado = false;

// RESET SECRETO
if(location.search.includes("reset=12345")){
  database.ref("ranking").set({});
  database.ref("votes").set({});
  alert("‚úÖ Ranking zerado com sucesso!");
}

// CRIA BOT√ïES POR CATEGORIA E ARTISTA
function criarBotoes(filter="") {
  container.innerHTML = "";
  Object.keys(musicas).forEach(categoria => {
    let catDiv = document.createElement("div");
    catDiv.className = "category";
    catDiv.innerText = categoria;
    container.appendChild(catDiv);

    const artistas = musicas[categoria];
    Object.keys(artistas).forEach(artista => {
      // verifica filtro
      if(filter && !artista.toLowerCase().includes(filter) && !artistas[artista].some(m=>m.toLowerCase().includes(filter))) return;

      let artDiv = document.createElement("div");
      artDiv.style.fontWeight = "bold";
      artDiv.style.marginTop = "10px";
      artDiv.innerText = artista;
      container.appendChild(artDiv);

      artistas[artista].forEach(musica => {
        const btn = document.createElement("button");
        btn.innerText = musica;
        btn.onclick = function() {
          if(bloqueado) return;
          bloqueado = true;

          const rankingRef = database.ref("ranking/"+musica);
          rankingRef.transaction(current => (current || 0)+1);

          message.innerText = "‚úÖ Voto computado!";
          document.querySelectorAll("button").forEach(b=>b.disabled=true);

          let tempo=5;
          countdownDiv.innerText = `‚è≥ Pr√≥ximo voto em: ${tempo}s`;
          const interval = setInterval(()=>{
            tempo--;
            if(tempo>0){
              countdownDiv.innerText = `‚è≥ Pr√≥ximo voto em: ${tempo}s`;
            } else {
              clearInterval(interval);
              bloqueado=false;
              countdownDiv.innerText="";
              message.innerText="";
              document.querySelectorAll("button").forEach(b=>b.disabled=false);
            }
          },1000);
        };
        container.appendChild(btn);
      });
    });
  });
}

// Inicializa os bot√µes
criarBotoes();

// BUSCA
const searchInput = document.getElementById("searchInput");
searchInput.addEventListener("input", e=>{
  criarBotoes(e.target.value.toLowerCase());
});

// RANKING AO VIVO
database.ref("ranking").on("value", snapshot=>{
  const data = snapshot.val() || {};
  const sorted = Object.entries(data).sort((a,b)=>b[1]-a[1]);
  let html="";
  sorted.forEach((item,index)=>{
    html += "<div class='rankItem'>"+(index+1)+"¬∫ - "+item[0]+" ("+item[1]+" votos)</div>";
  });
  document.getElementById("rankingList").innerHTML=html;
});
</script>

</body>
</html>
